// Generated by CoffeeScript 1.7.1
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['../ResourceScraper', 'underscore'], function(ResourceScraper, _) {
  var PatternResourceScraper;
  return PatternResourceScraper = (function(_super) {
    __extends(PatternResourceScraper, _super);

    function PatternResourceScraper(pattern, match, _default) {
      this.pattern = pattern;
      this.match = match;
      this["default"] = _default;
      if (this === window) {
        return ResourceScraper(arguments);
      }
    }

    PatternResourceScraper.prototype.scrape = function(cb) {
      var i, m, map, match, matches, pattern, _i, _len, _ref, _ref1, _ref2;
      map = (_ref = this.map) != null ? _ref : (function(value) {
        return value;
      });
      if (_.isArray(this.pattern)) {
        _ref1 = this.pattern;
        for (i = _i = 0, _len = _ref1.length; _i < _len; i = ++_i) {
          _ref2 = _ref1[i], pattern = _ref2[0], match = _ref2[1], m = _ref2[2];
          matches = this.resource[i === this.pattern.length - 1 ? 'safeMatch' : 'match'](pattern);
          if (matches) {
            cb((m != null ? m : map)(matches[match]));
            return;
          }
        }
        return cb(null);
      } else {
        matches = this.resource[this["default"] != null ? 'match' : 'safeMatch'](this.pattern);
        if (matches) {
          return cb(map(matches[this.match]));
        } else if (this["default"] != null) {
          return cb(this["default"]);
        } else {
          return cb(null);
        }
      }
    };

    return PatternResourceScraper;

  })(ResourceScraper);
});

//# sourceMappingURL=PatternResourceScraper.map
