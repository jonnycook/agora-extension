// Generated by CoffeeScript 1.10.0
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

define(function() {
  return {
    d: ['DataDrivenSiteInjector'],
    c: function() {
      var Singer22SiteInjector;
      return Singer22SiteInjector = (function(superClass) {
        extend(Singer22SiteInjector, superClass);

        function Singer22SiteInjector() {
          return Singer22SiteInjector.__super__.constructor.apply(this, arguments);
        }

        Singer22SiteInjector.prototype.productListing = {
          init: function() {
            var parseUrl;
            if ($('#category-rotator-category-container')) {
              parseUrl = function(url) {
                var id, ref, ref1, ref2;
                id = null;
                if (!id) {
                  id = (ref = url.match(/http:\/\/cdn2\.singer22\.com\/static\/insets\/[^\/]*\/([^_]*)/)) != null ? ref[1] : void 0;
                }
                if (!id) {
                  id = (ref1 = url.match(/^http:\/\/\d*\.images\.singer22\.com\/static\/(?:products|insets)\/[^\/]*\/([^.]*)/)) != null ? ref1[1] : void 0;
                }
                if (!id) {
                  id = (ref2 = url.match(/^http:\/\/cdn2\.singer22\.com\/static\/(?:products|insets)\/[^\/]*\/([^.]*)/)) != null ? ref2[1] : void 0;
                }
                if (id) {
                  return id.toLowerCase();
                }
              };
              return Q.setInterval(((function(_this) {
                return function() {
                  var el, i, id, len, ref, results;
                  ref = $('#category-rotator-category-container img');
                  results = [];
                  for (i = 0, len = ref.length; i < len; i++) {
                    el = ref[i];
                    el = $(el);
                    id = parseUrl(el.attr('src'));
                    if (id) {
                      if (el.data('agora-productSid') !== id) {
                        el.parent().css('position', 'relative');
                        el.parent().removeAttr('agora');
                        _this.removeOverlay(el.parent());
                        _this.attachOverlay({
                          attachEl: el.parent(),
                          positionEl: el,
                          productData: {
                            productSid: id
                          }
                        });
                        _this.clearProductEl(el);
                        _this.initProductEl(el, {
                          productSid: id
                        }, {
                          overlay: false
                        });
                        results.push(Q(el).data('agora-productSid', id));
                      } else {
                        results.push(void 0);
                      }
                    } else {
                      results.push(void 0);
                    }
                  }
                  return results;
                };
              })(this)), 500);
            }
          },
          mode: 2,
          selectors: {
            'a[href*="sku="] img': {
              overlayPosition: 'topLeft',
              productData: function(href, a, img) {
                var matches;
                matches = href.match(/[?&]sku=(.*?)(?:$|&|#)/);
                if (matches) {
                  return {
                    productSid: matches[1]
                  };
                }
              }
            },
            '.item.pinproduct': {
              image: function(el) {
                return el.find('.rotator ul li:first img');
              },
              anchor: function(el) {
                return el.find('.rotator .mask');
              },
              anchorProxy: true,
              productData: function(href, a, img, el) {
                var matches;
                href = el.find('[itemprop="url"]').attr('href');
                matches = href.match(/[?&]sku=(.*?)(?:$|&|#)/);
                if (matches) {
                  return {
                    productSid: matches[1]
                  };
                }
              },
              overlayPosition: 'topLeft'
            }
          }
        };

        Singer22SiteInjector.prototype.productPage = {
          mode: 2,
          test: function() {
            return $('div#styleData[itemtype="http://schema.org/Product"]').length;
          },
          productSid: function() {
            var matches;
            matches = document.location.href.match(/[?&]sku=(.*?)(?:$|&|#)/);
            if (matches) {
              return matches[1];
            }
          },
          variant: function() {
            if ($('#productColors .productColorSelected').attr('title')) {
              return {
                Color: $('#productColors .productColorSelected').attr('title')
              };
            }
          },
          image: '#productMainThumb',
          attach: '#styleData',
          zIndex: 999
        };

        return Singer22SiteInjector;

      })(DataDrivenSiteInjector);
    }
  };
});

//# sourceMappingURL=Singer22SiteInjector.js.map
