// Generated by CoffeeScript 1.10.0
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

define(['scraping/ProductScraper', 'scraping/resourceScrapers/PatternResourceScraper', 'scraping/resourceScrapers/ScriptedResourceScraper', 'underscore'], function(ProductScraper, PatternResourceScraper, ScriptedResourceScraper, _) {
  var NeweggProductScraper, matchAll, unescape;
  matchAll = function(string, pattern) {
    var i, len, match, matches, results;
    matches = string.match(new RegExp((_.isString(pattern) ? pattern : pattern.source), 'g'));
    if (matches) {
      results = [];
      for (i = 0, len = matches.length; i < len; i++) {
        match = matches[i];
        results.push(match.match(pattern));
      }
      return results;
    } else {
      return [];
    }
  };
  unescape = function(string) {
    var from, map, to;
    map = {
      '&#58;': ':',
      '&#47;': '/'
    };
    for (from in map) {
      to = map[from];
      string = string.replace(new RegExp(from, 'g'), to);
    }
    return string;
  };
  return NeweggProductScraper = (function(superClass) {
    extend(NeweggProductScraper, superClass);

    function NeweggProductScraper() {
      return NeweggProductScraper.__super__.constructor.apply(this, arguments);
    }

    NeweggProductScraper.prototype.resources = {
      productPage: {
        url: function() {
          return "http://www.newegg.com/Product/Product.aspx?Item=" + this.productSid;
        }
      },
      detailsPage: {
        url: function() {
          return "http://www.newegg.com/LandingPage/ItemInfo4ProductDetail2013.aspx?Item=" + this.productSid + "&v2=2012";
        }
      },
      relationPage: {
        url: function() {
          return "http://content.newegg.com/Common/Ajax/RelationItemInfo.aspx?item=" + this.productSid + "&type=Newegg&v2=2012";
        }
      }
    };

    NeweggProductScraper.prototype.properties = {
      title: {
        resource: 'productPage',
        scraper: PatternResourceScraper(new RegExp(/"imageTitle":"([^"]*)/), 1)
      },
      price: {
        resource: 'detailsPage',
        scraper: ScriptedResourceScraper(function() {
          var matches;
          matches = this.resource.match(/"finalPrice":"([^"]*)"/);
          if (matches) {
            return this.value(matches[1]);
          } else {
            matches = this.resource.match(/<li class=\\"price-current \\" itemprop=\\"price\\" content=\\"([^\\]*)\\"/);
            return this.value(matches[1]);
          }
        })
      },
      image: {
        resource: 'productPage',
        scraper: PatternResourceScraper(new RegExp(/<img id="mainSlide[^"]*" onload="[^"]*" title="[^"]*" alt="[^"]*" src="([^"]*)/), 1)
      }
    };

    return NeweggProductScraper;

  })(ProductScraper);
});

//# sourceMappingURL=NeweggProductScraper.js.map
