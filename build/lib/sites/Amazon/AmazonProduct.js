// Generated by CoffeeScript 1.10.0
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

define(['scraping/SiteProduct', 'ext/AmazonProductWidgets'], function(SiteProduct, AmazonProductWidgets) {
  var AmazonProduct;
  return AmazonProduct = (function(superClass) {
    extend(AmazonProduct, superClass);

    function AmazonProduct() {
      return AmazonProduct.__super__.constructor.apply(this, arguments);
    }

    AmazonProduct.prototype.matchFeature = function(cb, predicate) {
      return this.product["with"]('more', (function(_this) {
        return function(more) {
          var feature, j, len, ref, value;
          if (more.features) {
            ref = more.features;
            for (j = 0, len = ref.length; j < len; j++) {
              feature = ref[j];
              value = predicate(feature);
              if (value) {
                cb(value);
                return;
              }
            }
          }
          return cb();
        };
      })(this));
    };

    AmazonProduct.prototype.widgets = AmazonProductWidgets;

    AmazonProduct.prototype.images = function(cb) {
      return this.product["with"]('more', (function(_this) {
        return function(more) {
          var color, colorImages, image, images, j, len, ref, ref1;
          images = {};
          ref = more.images;
          for (color in ref) {
            colorImages = ref[color];
            images[color] = [];
            for (j = 0, len = colorImages.length; j < len; j++) {
              image = colorImages[j];
              images[color].push({
                small: image.large.match('^(.*?)\.jpg$')[1] + '._SL100_.jpg',
                medium: image.large,
                large: (ref1 = image.hiRes) != null ? ref1 : image.large,
                larger: image.hiRes ? image.hiRes.replace(/(\.[^.]*)(\.jpg)$/, '._SL1000_$2') : image.large,
                full: image.hiRes ? image.hiRes.replace(/(\.[^.]*)(\.jpg)$/, '$2') : image.large
              });
            }
          }
          return cb(images, more.currentStyle);
        };
      })(this));
    };

    AmazonProduct.prototype.reviews = function(cb) {
      return this.product["with"]('reviews', cb);
    };

    AmazonProduct.prototype.type = function(cb) {
      var map;
      map = {
        'Nursing & Maternity Bras': 'brassiere'
      };
      return this.product["with"]('more', (function(_this) {
        return function(more) {
          return cb(map[more.category[more.category.length - 1]]);
        };
      })(this));
    };

    AmazonProduct.prototype.types = {
      garment: {
        'Wash Instructions': function(cb) {
          return this.product["with"]('more', (function(_this) {
            return function(more) {
              var feature, j, len, ref;
              if (more.features) {
                ref = more.features;
                for (j = 0, len = ref.length; j < len; j++) {
                  feature = ref[j];
                  if (feature.toLowerCase().match('wash') || feature.toLowerCase().match('dry clean')) {
                    cb(feature);
                    return;
                  }
                }
              }
              return cb(void 0);
            };
          })(this));
        },
        'Origin': function(cb) {
          return this.product["with"]('more', (function(_this) {
            return function(more) {
              var feature, j, len, ref, ref1;
              if (more.features) {
                ref = more.features;
                for (j = 0, len = ref.length; j < len; j++) {
                  feature = ref[j];
                  if (feature.toLowerCase().match('china|made in|imported')) {
                    cb(feature);
                    return;
                  }
                }
              }
              return cb((ref1 = more.details) != null ? ref1.Origin : void 0);
            };
          })(this));
        },
        'Materials': function(cb) {
          return this.product["with"]('more', (function(_this) {
            return function(more) {
              var highest, highestIndex, i, item, j, len, matches, materialSample, ref;
              materialSample = 'polyester|cotton|polyamide|elastane|nylon|spandex|rayon|Lycra&reg;|spandex|viscose|recycled|polyester|linen|Tactel&reg;|nylon|acrylic|down|feather|polyurethane|cashmere|corduroy|denim|angora|wool|satin|taffeta|leather|twill|acetate|lycra|lyocell|tweed|canvas|ripstop|sheepskin|silk|velvet|chiffon|jersey|suede|velour|vinyl|tricot|fleece|modal|microfiber|mesh';
              highest = 0;
              highestIndex = -1;
              if (more.features) {
                ref = more.features;
                for (i = j = 0, len = ref.length; j < len; i = ++j) {
                  item = ref[i];
                  matches = item.toLowerCase().match(materialSample, 'g');
                  if (matches) {
                    if (matches.length > highest) {
                      highestIndex = i;
                      highest = matches.index;
                    }
                  }
                }
                if (highestIndex !== -1) {
                  return cb(more.features[highestIndex]);
                } else {
                  return cb(void 0);
                }
              } else {
                return cb(void 0);
              }
            };
          })(this));
        }
      },
      trousers: {
        'Closure': function(cb) {
          return this.product["with"]('more', (function(_this) {
            return function(more) {
              var feature, j, len, ref;
              if (more.features) {
                ref = more.features;
                for (j = 0, len = ref.length; j < len; j++) {
                  feature = ref[j];
                  if (feature.toLowerCase().match('closure')) {
                    cb(feature);
                    return;
                  }
                }
              }
              return cb();
            };
          })(this));
        }
      },
      brassiere: {
        'Closure': function(cb) {
          return this.product["with"]('more', (function(_this) {
            return function(more) {
              var feature, j, len, ref;
              if (more.feature) {
                ref = more.features;
                for (j = 0, len = ref.length; j < len; j++) {
                  feature = ref[j];
                  if (feature.toLowerCase().match('closure')) {
                    cb(feature);
                    return;
                  }
                }
              }
              return cb();
            };
          })(this));
        },
        'Straps': function(cb) {
          return this.product["with"]('more', (function(_this) {
            return function(more) {
              var feature, j, len, ref;
              if (more.features) {
                ref = more.features;
                for (j = 0, len = ref.length; j < len; j++) {
                  feature = ref[j];
                  if (feature.toLowerCase().match('straps')) {
                    cb(feature);
                    return;
                  }
                }
              }
              return cb();
            };
          })(this));
        }
      },
      'video card': {
        'Core Clock': function(cb) {
          return this.matchFeature(cb, function(feature) {
            var ref;
            return (ref = feature.match(/^Core Clock: (.*)$/)) != null ? ref[1] : void 0;
          });
        },
        'Boost Clock': function(cb) {
          return this.matchFeature(cb, function(feature) {
            var ref;
            return (ref = feature.match(/^Boost Clock: (.*)$/)) != null ? ref[1] : void 0;
          });
        },
        'GPU': function(cb) {
          return this.matchFeature(cb, function(feature) {
            var ref;
            return (ref = feature.match(/^Chipset: (.*)$/)) != null ? ref[1] : void 0;
          });
        },
        'Interface': function(cb) {
          return this.matchFeature(cb, function(feature) {
            if (feature.toLowerCase().match('pci express')) {
              return feature;
            }
          });
        }
      }
    };

    return AmazonProduct;

  })(SiteProduct);
});

//# sourceMappingURL=AmazonProduct.js.map
