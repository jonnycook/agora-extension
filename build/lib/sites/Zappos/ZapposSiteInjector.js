// Generated by CoffeeScript 1.7.1
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(function() {
  return {
    d: ['SiteInjector', 'views/ShoppingBarView', 'DataDrivenSiteInjector'],
    c: function() {
      var ZapposSiteInjector;
      return ZapposSiteInjector = (function(_super) {
        __extends(ZapposSiteInjector, _super);

        function ZapposSiteInjector() {
          return ZapposSiteInjector.__super__.constructor.apply(this, arguments);
        }

        ZapposSiteInjector.prototype.siteName = 'Zappos';

        ZapposSiteInjector.prototype.productListing = {
          mode: 2,
          selectors: {
            'a[rel=product] img, a.product img, .productReviews a img': {
              productData: function(href, a, img, el) {
                var matches;
                matches = /http:\/\/[^.]*.zassets.com\/images\/[a-z]*\/\d\/.*?\/(\d*)-[a-z]-\w*\.jpg/.exec(img.attr('src'));
                if (matches) {
                  return {
                    productUrl: href,
                    retrievalId: matches[1]
                  };
                }
              }
            }
          }
        };

        ZapposSiteInjector.prototype.productPage = {
          mode: 2,
          test: function() {
            return $('#content.productPage').length;
          },
          image: '#detailImage img, #detailImage2 img, #actors img',
          attach: '#prdImage',
          productSid: function() {
            var colorId, sku;
            sku = $('#sku').html().match('^SKU (\\d+)')[1];
            colorId = $('#color').val();
            return "" + sku + "-" + colorId;
          }
        };

        ZapposSiteInjector.prototype.initProduct = function() {
          var colorId, productSid, sku;
          sku = $('#sku').html().match('^SKU (\\d+)')[1];
          colorId = $('#color').val();
          productSid = "" + sku + "-" + colorId;
          this.buttonView.represent({
            siteName: this.siteName,
            productSid: productSid
          });
          this.products('#detailImage img', {
            siteName: this.siteName,
            productSid: productSid
          });
          this.products('#detailImage2 img', {
            siteName: this.siteName,
            productSid: productSid
          });
          return this.bottomBarView.activeProduct = {
            siteName: this.siteName,
            productSid: productSid
          };
        };

        ZapposSiteInjector.prototype.runOff = function() {
          return this.initPage((function(_this) {
            return function() {
              var currentSid, initProduct, initProducts, selector;
              _this.bottomBarView = new ShoppingBarView(_this.contentScript);
              _this.bottomBarView.el.appendTo(document.body);
              _this.bottomBarView.represent();
              initProduct = function(el, retrievalId, url, mousedover) {
                return _this.initProductEl(el, {
                  productUrl: url,
                  retrievalId: retrievalId
                }, {
                  hovering: mousedover
                });
              };
              selector = 'a[rel=product] img, a.product img, .productReviews a img';
              window.initProducts = initProducts = function() {
                return $(selector).each(function() {
                  var a, matches;
                  matches = /http:\/\/[^.]*.zassets.com\/images\/[a-z]*\/\d\/.*?\/(\d*)-[a-z]-\w*\.jpg/.exec($(this).attr('src'));
                  if (matches) {
                    a = $(this).parents('a');
                    return initProduct(this, matches[1], a.prop('href'), false);
                  }
                });
              };
              initProducts();
              setInterval(initProducts, 2000);
              currentSid = function() {
                var colorId, sku;
                sku = $('#sku').html().match('^SKU (\\d+)')[1];
                colorId = $('#color').val();
                return "" + sku + "-" + colorId;
              };
              $('body').delegate('#actors .actor img', 'mouseover', function(e) {
                _this.clearProductEl(e.target);
                return _this.initProductEl(e.target, {
                  productSid: currentSid()
                }, {
                  overlay: false
                });
              });
              $(function() {
                return _this.initProductEl($('#protagonist'), {
                  productSid: currentSid()
                }, {
                  image: false,
                  initOverlay: function(overlay) {
                    overlay.addAlwaysShow('productPage');
                    return overlay.autoFixPosition();
                  }
                });
              });
              return true;
            };
          })(this));
        };

        return ZapposSiteInjector;

      })(DataDrivenSiteInjector);
    }
  };
});

//# sourceMappingURL=ZapposSiteInjector.map
