// Generated by CoffeeScript 1.7.1
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['scraping/ProductScraper', 'scraping/resourceScrapers/PatternResourceScraper', 'scraping/resourceScrapers/ScriptedResourceScraper', 'scraping/resourceScrapers/JsonResourceScraper', 'underscore'], function(ProductScraper, PatternResourceScraper, ScriptedResourceScraper, JsonResourceScraper, _) {
  var FabProductScraper;
  return FabProductScraper = (function(_super) {
    __extends(FabProductScraper, _super);

    function FabProductScraper() {
      return FabProductScraper.__super__.constructor.apply(this, arguments);
    }

    FabProductScraper.prototype.resources = {
      productPage: {
        url: function() {
          return "http://fab.com/product/" + this.productSid;
        }
      }
    };

    FabProductScraper.prototype.properties = {
      title: {
        resource: 'productPage',
        scraper: PatternResourceScraper(/<h1 id="productTitle" itemprop="name">([^<]*)/, 1)
      },
      price: {
        resource: 'productPage',
        scraper: PatternResourceScraper(/<span itemprop="price">\s*\$(\S*)/, 1)
      },
      image: {
        resource: 'productPage',
        scraper: PatternResourceScraper(/<meta itemprop="image" content="([^"]*)/, 1).config({
          map: function(value) {
            return "http:" + value;
          }
        })
      },
      ratingCount: {
        resource: 'productPage',
        scraper: PatternResourceScraper(/<h5 class="dIB product-page-top-ratings-number-display">\s*\((\d+) rating\)/, 1, 0)
      },
      rating: {
        resource: 'productPage',
        scraper: PatternResourceScraper(/<h2 class="product-page-average-rating-large">([^<]*)/, 1, 0)
      },
      more: {
        resource: 'productPage',
        scraper: ScriptedResourceScraper(function() {
          var more, moreDetails, _ref;
          more = {};
          more.description = this.resource.match(/<div class="productPgDisc" itemprop="description">([\S\s]*?)<\/div>/)[1].trim();
          moreDetails = {};
          moreDetails.description = (_ref = this.resource.match(/<div class="desc">([\S\s]*?)<\/div>/)) != null ? _ref[1].trim() : void 0;
          (function(_this) {
            return (function() {
              var attributes, itemMatches, match, matches, _i, _len;
              match = /<ul class="tblList" id="tblListTgl">([\S\s]*?)<\/ul>/.exec(_this.resource)[1];
              itemMatches = _this.matchAll(match, /<div class="productAttr">([^<]*)<\/div>\s*<div class="productAttr\d*Details"[^>]*>([^<]*)<\/div>/);
              attributes = {};
              for (_i = 0, _len = itemMatches.length; _i < _len; _i++) {
                matches = itemMatches[_i];
                attributes[matches[1].trim()] = matches[2].trim();
              }
              return moreDetails.attributes = attributes;
            });
          })(this)();
          more.moreDetails = moreDetails;
          return this.value(more);
        })
      }
    };

    return FabProductScraper;

  })(ProductScraper);
});

//# sourceMappingURL=FabProductScraper.map
