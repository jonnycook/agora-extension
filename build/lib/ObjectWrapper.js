// Generated by CoffeeScript 1.10.0
define(['model/ObservableValue'], function(ObservableValue) {
  var ObjectWrapper;
  return ObjectWrapper = (function() {
    ObjectWrapper.create = function(storeId, object, defaults) {
      return new ObjectWrapper(storeId, object, defaults);
    };

    ObjectWrapper.prototype.getObject = function() {
      if (this.object === '@') {
        return agora.modelManager.getInstance('User', "G" + this.storeId);
      }
    };

    ObjectWrapper.prototype.field = function(name) {
      return this.fields[name];
    };

    ObjectWrapper.prototype.get = function(name) {
      var id, ref, table;
      if (name === 'id') {
        if (this.object === '@') {
          return "G" + this.storeId;
        } else if (this.object === '/') {
          throw new Error;
        } else {
          ref = this.object.split('.'), table = ref[0], id = ref[1];
          return "G" + id;
        }
      } else {
        return this.fields[name].get();
      }
    };

    ObjectWrapper.prototype.saneId = function() {
      return parseInt(this.get('id').substr(1));
    };

    function ObjectWrapper(storeId1, object1, values) {
      var name, ref, value;
      this.storeId = storeId1;
      this.object = object1;
      this.values = values;
      this.empty = true;
      this.fields = {};
      ref = this.values;
      for (name in ref) {
        value = ref[name];
        this.fields[name] = new ObservableValue(value);
      }
      this.whenObject = agora.updater.transport.whenObject(this.storeId, [this.object], (function(_this) {
        return function() {
          var field, ref1, results;
          _this.empty = false;
          _this.obj = _this.getObject();
          ref1 = _this.fields;
          results = [];
          for (name in ref1) {
            field = ref1[name];
            results.push(field.set(_this.obj.get(name)));
          }
          return results;
        };
      })(this), (function(_this) {
        return function() {
          var field, ref1, results;
          _this.empty = true;
          ref1 = _this.fields;
          results = [];
          for (name in ref1) {
            field = ref1[name];
            results.push(field.set(_this.values[name]));
          }
          return results;
        };
      })(this));
    }

    ObjectWrapper.prototype.destruct = function() {
      return agora.updater.transport.unregisterWhenObject(this.whenObject);
    };

    return ObjectWrapper;

  })();
});

//# sourceMappingURL=ObjectWrapper.js.map
