// Generated by CoffeeScript 1.7.1
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['./ObservableArray', './auxiliary/maintainOrder', './Relationship'], function(ObservableArray, maintainOrder, Relationship) {
  var HasOneRelationship;
  return HasOneRelationship = (function(_super) {
    __extends(HasOneRelationship, _super);

    HasOneRelationship.prototype.get = function(propertyName) {
      var _ref;
      return (_ref = this._relInstance) != null ? _ref.get(propertyName) : void 0;
    };

    HasOneRelationship.prototype._get = function(propertyName) {
      var _ref;
      return (_ref = this._relInstance) != null ? _ref._get(propertyName) : void 0;
    };

    HasOneRelationship.prototype.set = function(propertyName, value) {
      var _ref;
      return (_ref = this._relInstance) != null ? _ref.set(propertyName, value) : void 0;
    };

    HasOneRelationship.prototype.field = function(propertyName) {
      var _ref;
      return (_ref = this._relInstance) != null ? _ref.field(propertyName) : void 0;
    };

    HasOneRelationship.prototype["delete"] = function() {
      var _ref;
      return (_ref = this._relInstance) != null ? _ref["delete"]() : void 0;
    };

    HasOneRelationship.prototype.tableName = function() {
      var _ref;
      return (_ref = this._relInstance) != null ? _ref.tableName() : void 0;
    };

    HasOneRelationship.prototype.saneId = function() {
      return this._relInstance.saneId();
    };

    HasOneRelationship.prototype.equals = function(instance) {
      return this._relInstance.equals(instance);
    };

    HasOneRelationship.prototype.isA = function(modelName) {
      return this._relInstance.isA(modelName);
    };

    HasOneRelationship.prototype.isNull = function() {
      return !this._relInstance;
    };

    HasOneRelationship.prototype["with"] = function() {
      var _ref;
      return (_ref = this._relInstance)["with"].apply(_ref, arguments);
    };

    HasOneRelationship.prototype.retrieve = function() {
      var _ref;
      return (_ref = this._relInstance).retrieve.apply(_ref, arguments);
    };

    function HasOneRelationship(_instance, _args, _relName) {
      var model, updateRelInstance;
      this._instance = _instance;
      this._args = _args;
      this._relName = _relName;
      if (!this._args.relKey) {
        throw new Error('no relKey');
      }
      model = (function(_this) {
        return function() {
          var name;
          if (typeof _this._args.model === 'function') {
            name = _this._args.model(_this._instance);
            if (name) {
              return _this._instance.model.manager.getModel(name);
            }
          } else {
            return _this._args.model;
          }
        };
      })(this);
      updateRelInstance = (function(_this) {
        return function() {
          var id, method, _fn, _i, _j, _len, _len1, _ref, _ref1;
          if (_this._relInstance) {
            if (_this._relInstance.instanceMethods) {
              _ref = _this._relInstance.instanceMethods;
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                method = _ref[_i];
                delete _this[method];
              }
            }
          }
          id = _this._instance.get(_this._args.relKey);
          if (id) {
            _this._relInstance = model().withId(id);
            _this.model = model();
            _this.modelName = _this.model.name;
            _this.record = _this._relInstance.record;
            if (_this._relInstance.instanceMethods) {
              _ref1 = _this._relInstance.instanceMethods;
              _fn = function(method) {
                return _this[method] = function() {
                  return _this._relInstance[method].apply(_this._relInstance, arguments);
                };
              };
              for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
                method = _ref1[_j];
                _fn(method);
              }
            }
          } else {
            _this._relInstance = null;
            _this.model = _this.record = null;
          }
          return _this._fireMutation('changed');
        };
      })(this);
      updateRelInstance();
      this.observeObject(this._instance.field(this._args.relKey), updateRelInstance);
      this.onDestruct = function() {
        return this._instance.field(this._args.relKey).stopObserving(updateRelInstance);
      };
    }

    return HasOneRelationship;

  })(Relationship);
});

//# sourceMappingURL=HasOneRelationship.map
