// Generated by CoffeeScript 1.10.0
var props, scrapeProduct, scrapeProducts;

require(['Agora', '../scraper/ScraperBackground'], function(Agora, ScraperBackground) {
  var agora, background;
  window.background = background = new ScraperBackground({
    client: false
  });
  return window.agora = agora = new Agora(background, {
    localTest: true,
    autoUpdate: env.autoUpdate,
    client: false,
    onLoaded: function() {}
  });
});

props = ['price'];

scrapeProduct = function(site, sid, json) {
  var lastProduct;
  if (json == null) {
    json = false;
  }
  lastProduct = {
    site: site,
    sid: sid
  };
  return agora.Site.site(site).productScraper(agora.background, sid, function(scraper) {
    return scraper.scrape(props, function(properties) {
      var name, results, value;
      results = [];
      for (name in properties) {
        value = properties[name];
        results.push(console.log(name + " = " + value));
      }
      return results;
    });
  });
};

scrapeProducts = function(cb, products) {
  var i, len, product, results;
  results = [];
  for (i = 0, len = products.length; i < len; i++) {
    product = products[i];
    results.push((function(product) {
      return agora.Site.site(product.siteName).productScraper(agora.background, product.productSid, function(scraper) {
        return scraper.scrape(['price'], function(properties) {
          return background.httpRequest(cb, {
            method: 'post',
            data: {
              product: product,
              prices: {
                listing: properties.price * 100
              }
            },
            cb: function(response) {
              return console.log(response);
            }
          });
        });
      });
    })(product));
  }
  return results;
};

//# sourceMappingURL=background.js.map
