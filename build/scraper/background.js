// Generated by CoffeeScript 1.7.1
var props, scrapeProduct, scrapeProducts;

require(['Agora', '../scraper/ScraperBackground'], function(Agora, ScraperBackground) {
  var agora, background;
  window.background = background = new ScraperBackground({
    client: false
  });
  return window.agora = agora = new Agora(background, {
    localTest: true,
    autoUpdate: env.autoUpdate,
    client: false,
    onLoaded: function() {}
  });
});

props = ['price'];

scrapeProduct = function(site, sid, json) {
  var lastProduct;
  if (json == null) {
    json = false;
  }
  lastProduct = {
    site: site,
    sid: sid
  };
  return agora.Site.site(site).productScraper(agora.background, sid, function(scraper) {
    return scraper.scrape(props, function(properties) {
      var name, value, _results;
      _results = [];
      for (name in properties) {
        value = properties[name];
        _results.push(console.log("" + name + " = " + value));
      }
      return _results;
    });
  });
};

scrapeProducts = function(cb, products) {
  var product, _i, _len, _results;
  _results = [];
  for (_i = 0, _len = products.length; _i < _len; _i++) {
    product = products[_i];
    _results.push((function(product) {
      return agora.Site.site(product.siteName).productScraper(agora.background, product.productSid, function(scraper) {
        return scraper.scrape(['price'], function(properties) {
          return background.httpRequest(cb, {
            method: 'post',
            data: {
              product: product,
              prices: {
                listing: properties.price * 100
              }
            },
            cb: function(response) {
              return console.log(response);
            }
          });
        });
      });
    })(product));
  }
  return _results;
};

//# sourceMappingURL=background.map
